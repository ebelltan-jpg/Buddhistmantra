<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>莲花童子心咒精进系统</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600&display=swap');
    
    body {
      font-family: 'Noto Serif SC', serif;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
    
    .star {
      position: absolute;
      width: 2px;
      height: 2px;
      background: white;
      border-radius: 50%;
      animation: twinkle 3s infinite;
    }
    
    @keyframes twinkle {
      0%, 100% { opacity: 0.1; transform: scale(1); }
      50% { opacity: 0.4; transform: scale(1.5); }
    }
    
    @keyframes radiancePulse {
      0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
      50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
      100% { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
    }
    
    @keyframes floatUp {
      0% { opacity: 0; transform: translateY(0) scale(0.8); }
      20% { opacity: 1; }
      70% { opacity: 0.7; }
      100% { opacity: 0; transform: translateY(-100px) scale(1); }
    }
    
    .radiance-flash {
      animation: radiancePulse 0.6s ease-out;
    }
    
    .float-mantra {
      animation: floatUp 3s ease-out forwards;
    }

    /* 佛珠样式 */
    .bead {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      position: absolute;
      background: linear-gradient(135deg, #8B4513 0%, #A0522D 50%, #8B4513 100%);
      box-shadow: inset -2px -2px 4px rgba(0,0,0,0.3), inset 2px 2px 4px rgba(255,255,255,0.1);
      transition: all 0.3s ease;
    }
    
    .bead.active {
      background: linear-gradient(135deg, #FFD700 0%, #FFA500 50%, #FFD700 100%);
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.8), inset -2px -2px 4px rgba(0,0,0,0.2);
      transform: scale(1.3);
    }
    
    .bead.passed {
      background: linear-gradient(135deg, #DAA520 0%, #B8860B 50%, #DAA520 100%);
      box-shadow: 0 0 8px rgba(218, 165, 32, 0.4), inset -2px -2px 4px rgba(0,0,0,0.2);
    }

    /* 佛珠流苏 */
    .tassel {
      position: absolute;
      top: -30px;
      left: 50%;
      transform: translateX(-50%);
      width: 3px;
      height: 40px;
      background: linear-gradient(to bottom, #8B4513, #DAA520);
    }
    
    .tassel::after {
      content: '';
      position: absolute;
      bottom: -15px;
      left: 50%;
      transform: translateX(-50%);
      width: 20px;
      height: 20px;
      background: radial-gradient(circle, #DAA520 0%, #8B4513 100%);
      clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
    }

    /* 莲花按钮 */
    .lotus-button {
      width: 180px;
      height: 180px;
      position: relative;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .lotus-button:hover {
      transform: scale(1.1);
    }
    
    .lotus-button:active {
      transform: scale(0.95);
    }

    @media (max-width: 1024px) {
      .layout-container {
        flex-direction: column !important;
        padding: 1rem !important;
      }
      .beads-section, .deity-section, .stats-section {
        width: 100% !important;
        margin-bottom: 2rem;
      }
      .deity-section img {
        width: 300px !important;
      }
    }
  </style>
</head>
<body>
  <div class="relative w-full h-screen overflow-hidden bg-gradient-to-b from-[#0a1628] via-[#1a2742] to-[#0f1b33]">
    <!-- 音效 -->
    <audio id="audio" preload="auto">
      <source src="./莲生_1.wav" type="audio/wav">
    </audio>

    <!-- 星光背景 -->
    <div id="stars" class="absolute inset-0"></div>
    
    <!-- 背后大光明 -->
    <div id="radiance-bg" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[1200px] h-[1200px] rounded-full pointer-events-none" style="opacity: 0; background: radial-gradient(circle, rgba(255,215,0,0.4) 0%, rgba(255,215,0,0.2) 40%, transparent 70%);"></div>
    
    <!-- 放射光晕容器 -->
    <div id="radiance-container" class="absolute inset-0 pointer-events-none"></div>
    
    <!-- 飘散咒语容器 -->
    <div id="mantra-container" class="absolute inset-0 pointer-events-none"></div>

    <!-- 三栏布局 -->
    <div class="layout-container absolute inset-0 flex items-center justify-between px-8">
      
      <!-- 左侧：佛珠 -->
      <div class="beads-section w-1/4 flex items-center justify-center">
        <div class="relative w-80 h-80">
          <!-- 流苏 -->
          <div class="tassel"></div>
          
          <!-- 佛珠圆圈 -->
          <div id="beads-container" class="relative w-full h-full"></div>
          
          <!-- 佛珠计数 -->
          <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-center">
            <div id="bead-progress" class="text-amber-300 text-3xl font-bold">0/108</div>
          </div>
        </div>
      </div>

      <!-- 中间：咒语 + 法相 -->
      <div class="deity-section w-2/4 flex flex-col items-center justify-center gap-8">
        <!-- 咒语在上方 -->
        <div class="text-amber-100 text-4xl tracking-widest text-center leading-relaxed">
          嗡。咕噜。莲生。悉地。吽。
        </div>
        
        <!-- 法相 -->
        <div id="deity" class="relative transition-all duration-300" style="opacity: 0.2;">
          <img src="./師尊-2.png" alt="莲花童子法相" class="w-[500px] h-auto select-none" draggable="false">
        </div>
      </div>

      <!-- 右侧：今日精进 -->
      <div class="stats-section w-1/4 flex flex-col items-center justify-center gap-8">
        <div class="text-center">
          <p class="text-amber-100 text-lg tracking-widest mb-4">今日精进</p>
          <p id="today-count" class="text-white text-6xl mb-2">0</p>
          <p class="text-amber-200 text-2xl">/ 100,000 遍</p>
        </div>

        <div class="w-64">
          <div class="w-full h-3 bg-white/10 rounded-full overflow-hidden backdrop-blur-sm">
            <div id="progress-bar" class="h-full bg-gradient-to-r from-amber-400 to-amber-200 transition-all duration-500" style="width: 0%"></div>
          </div>
          <p id="progress-text" class="text-amber-200/60 text-sm text-center mt-3">还需 100,000 遍</p>
        </div>

        <div class="text-center mt-4">
          <p class="text-amber-100/60 text-sm mb-2">累积持诵</p>
          <p id="total-count" class="text-amber-100 text-3xl">0</p>
        </div>

        <div class="text-center mt-4">
          <p class="text-amber-100/60 text-sm mb-2">当前进度</p>
          <p id="current-round" class="text-amber-300 text-2xl">0 / 108</p>
        </div>
      </div>
    </div>

    <!-- 底部莲花按钮 -->
    <div class="absolute bottom-12 left-1/2 -translate-x-1/2 z-20">
      <div id="lotus-button" class="lotus-button">
        <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
          <!-- 外层花瓣 -->
          <g id="outer-petals">
            <ellipse cx="100" cy="60" rx="20" ry="45" fill="#f59e0b" opacity="0.8" transform="rotate(0 100 100)"/>
            <ellipse cx="100" cy="60" rx="20" ry="45" fill="#f59e0b" opacity="0.8" transform="rotate(45 100 100)"/>
            <ellipse cx="100" cy="60" rx="20" ry="45" fill="#f59e0b" opacity="0.8" transform="rotate(90 100 100)"/>
            <ellipse cx="100" cy="60" rx="20" ry="45" fill="#f59e0b" opacity="0.8" transform="rotate(135 100 100)"/>
            <ellipse cx="100" cy="60" rx="20" ry="45" fill="#f59e0b" opacity="0.8" transform="rotate(180 100 100)"/>
            <ellipse cx="100" cy="60" rx="20" ry="45" fill="#f59e0b" opacity="0.8" transform="rotate(225 100 100)"/>
            <ellipse cx="100" cy="60" rx="20" ry="45" fill="#f59e0b" opacity="0.8" transform="rotate(270 100 100)"/>
            <ellipse cx="100" cy="60" rx="20" ry="45" fill="#f59e0b" opacity="0.8" transform="rotate(315 100 100)"/>
          </g>
          
          <!-- 内层花瓣 -->
          <g id="inner-petals">
            <ellipse cx="100" cy="70" rx="18" ry="35" fill="#fbbf24" opacity="0.9" transform="rotate(22.5 100 100)"/>
            <ellipse cx="100" cy="70" rx="18" ry="35" fill="#fbbf24" opacity="0.9" transform="rotate(67.5 100 100)"/>
            <ellipse cx="100" cy="70" rx="18" ry="35" fill="#fbbf24" opacity="0.9" transform="rotate(112.5 100 100)"/>
            <ellipse cx="100" cy="70" rx="18" ry="35" fill="#fbbf24" opacity="0.9" transform="rotate(157.5 100 100)"/>
            <ellipse cx="100" cy="70" rx="18" ry="35" fill="#fbbf24" opacity="0.9" transform="rotate(202.5 100 100)"/>
            <ellipse cx="100" cy="70" rx="18" ry="35" fill="#fbbf24" opacity="0.9" transform="rotate(247.5 100 100)"/>
            <ellipse cx="100" cy="70" rx="18" ry="35" fill="#fbbf24" opacity="0.9" transform="rotate(292.5 100 100)"/>
            <ellipse cx="100" cy="70" rx="18" ry="35" fill="#fbbf24" opacity="0.9" transform="rotate(337.5 100 100)"/>
          </g>
          
          <!-- 莲花中心 -->
          <circle cx="100" cy="100" r="35" fill="#fde047" opacity="0.95"/>
          <circle cx="100" cy="100" r="30" fill="#facc15" opacity="0.9"/>
          
          <!-- 文字 -->
          <text x="100" y="105" font-size="20" fill="#78350f" text-anchor="middle" font-weight="bold">持咒</text>
        </svg>
      </div>
    </div>
  </div>

  <script>
    const DAILY_GOAL = 100000;
    const TOTAL_BEADS = 108;
    const MANTRA_TEXT = "嗡。咕噜。莲生。悉地。吽。";
    
    let totalCount = 0;
    let todayCount = 0;
    let currentBead = 0;
    let beadElements = [];
    let isChanting = false;
    let currentRound = 0;
    
    // 初始化星光
    const starsContainer = document.getElementById('stars');
    for (let i = 0; i < 50; i++) {
      const star = document.createElement('div');
      star.className = 'star';
      star.style.left = Math.random() * 100 + '%';
      star.style.top = Math.random() * 100 + '%';
      star.style.animationDelay = Math.random() * 2 + 's';
      star.style.animationDuration = (Math.random() * 3 + 2) + 's';
      starsContainer.appendChild(star);
    }
    
    // 初始化佛珠
    const beadsContainer = document.getElementById('beads-container');
    for (let i = 0; i < TOTAL_BEADS; i++) {
      const angle = (i * 360) / TOTAL_BEADS - 90;
      const radian = (angle * Math.PI) / 180;
      const radius = 150;
      const x = Math.cos(radian) * radius;
      const y = Math.sin(radian) * radius;
      
      const bead = document.createElement('div');
      bead.className = 'bead';
      bead.style.left = '50%';
      bead.style.top = '50%';
      bead.style.transform = `translate(${x}px, ${y}px) translate(-50%, -50%)`;
      
      beadsContainer.appendChild(bead);
      beadElements.push(bead);
    }
    
    // 更新佛珠状态
    function updateBeads() {
      beadElements.forEach((bead, i) => {
        const isActive = i === currentBead;
        const isPassed = i < currentBead;
        
        bead.classList.remove('active', 'passed');
        
        if (isActive) {
          bead.classList.add('active');
        } else if (isPassed) {
          bead.classList.add('passed');
        }
      });
    }
    
    // 加载数据
    function loadData() {
      try {
        const stored = localStorage.getItem('mantraData');
        if (stored) {
          const data = JSON.parse(stored);
          const today = new Date().toDateString();
          
          if (data.date === today) {
            todayCount = data.todayCount;
          } else {
            todayCount = 0;
            saveData(data.totalCount, 0);
          }
          totalCount = data.totalCount;
          currentBead = todayCount % TOTAL_BEADS;
        }
      } catch (e) {
        console.log('加载数据失败:', e);
      }
      updateDisplay();
      updateBeads();
    }
    
    // 保存数据
    function saveData(newTotal, newToday) {
      try {
        const today = new Date().toDateString();
        localStorage.setItem('mantraData', JSON.stringify({
          totalCount: newTotal,
          todayCount: newToday,
          date: today
        }));
      } catch (e) {
        console.log('保存数据失败:', e);
      }
    }
    
    // 更新显示
    function updateDisplay() {
      document.getElementById('total-count').textContent = totalCount.toLocaleString();
      document.getElementById('today-count').textContent = todayCount.toLocaleString();
      document.getElementById('bead-progress').textContent = `${currentBead}/108`;
      document.getElementById('current-round').textContent = `${currentRound} / 108`;
      
      const progressPercentage = Math.min((todayCount / DAILY_GOAL) * 100, 100);
      document.getElementById('progress-bar').style.width = progressPercentage + '%';
      
      if (todayCount >= DAILY_GOAL) {
        document.getElementById('progress-text').textContent = '✨ 今日目标已达成 ✨';
      } else {
        document.getElementById('progress-text').textContent = `还需 ${(DAILY_GOAL - todayCount).toLocaleString()} 遍`;
      }
    }
    
    // 单次诵念动画
    function singleChant() {
      // 播放音效
      const audio = document.getElementById('audio');
      audio.currentTime = 0;
      audio.play().catch(err => console.log('音效播放失败:', err));
      
      // 背后大光明闪耀
      const radianceBg = document.getElementById('radiance-bg');
      radianceBg.style.opacity = '1';
      setTimeout(() => {
        radianceBg.style.opacity = '0';
      }, 600);
      
      // 显示放射光晕
      const radiance = document.createElement('div');
      radiance.className = 'radiance-flash absolute top-1/2 left-1/2 w-[1000px] h-[1000px] rounded-full pointer-events-none';
      radiance.style.background = 'radial-gradient(circle, rgba(255,215,0,0.5) 0%, rgba(255,215,0,0.25) 30%, transparent 60%)';
      document.getElementById('radiance-container').appendChild(radiance);
      
      setTimeout(() => radiance.remove(), 600);
      
      // 创建飘散咒语
      const mantra = document.createElement('div');
      mantra.className = 'float-mantra absolute text-amber-300 text-xl pointer-events-none font-bold';
      mantra.textContent = MANTRA_TEXT;
      mantra.style.left = (Math.random() * 30 + 35) + '%';
      mantra.style.top = (Math.random() * 30 + 35) + '%';
      document.getElementById('mantra-container').appendChild(mantra);
      
      setTimeout(() => mantra.remove(), 3000);
    }
    
    // 连续诵念108遍
    async function chant108Times() {
      if (isChanting) return;
      
      isChanting = true;
      currentRound = 0;
      
      // 法相显现
      const deity = document.getElementById('deity');
      deity.style.opacity = '1';
      deity.style.transform = 'scale(1.05)';
      
      // 背后大光明持续显现
      const radianceBg = document.getElementById('radiance-bg');
      radianceBg.style.transition = 'opacity 0.5s';
      radianceBg.style.opacity = '0.6';
      
      for (let i = 0; i < 108; i++) {
        if (!isChanting) break;
        
        totalCount++;
        todayCount++;
        currentBead = todayCount % TOTAL_BEADS;
        currentRound = i + 1;
        
        saveData(totalCount, todayCount);
        updateDisplay();
        updateBeads();
        
        singleChant();
        
        // 每次间隔600ms
        await new Promise(resolve => setTimeout(resolve, 600));
      }
      
      // 108遍完成后，法相恢复半透明
      setTimeout(() => {
        deity.style.opacity = '0.2';
        deity.style.transform = 'scale(1)';
        radianceBg.style.opacity = '0';
        currentRound = 0;
        updateDisplay();
      }, 1000);
      
      isChanting = false;
    }
    
    // 点击莲花按钮
    document.getElementById('lotus-button').addEventListener('click', function() {
      chant108Times();
    });
    
    // 初始化
    loadData();
  </script>
</body>
</html>
