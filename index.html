<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>莲花童子心咒精进系统</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600&display=swap');
    
    body {
      font-family: 'Noto Serif SC', serif;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
    
    .star {
      position: absolute;
      width: 2px;
      height: 2px;
      background: white;
      border-radius: 50%;
      animation: twinkle 3s infinite;
    }
    
    @keyframes twinkle {
      0%, 100% { opacity: 0.1; transform: scale(1); }
      50% { opacity: 0.4; transform: scale(1.5); }
    }
    
    @keyframes radianceFlash {
      0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
      50% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
      100% { opacity: 0; transform: translate(-50%, -50%) scale(1.5); }
    }
    
    @keyframes floatUp {
      0% { opacity: 0; transform: translateY(0) scale(0.8); }
      20% { opacity: 1; }
      70% { opacity: 0.7; }
      100% { opacity: 0; transform: translateY(-100px) scale(1); }
    }
    
    @keyframes lotusGlow {
      0%, 100% { filter: drop-shadow(0 0 10px rgba(255, 182, 193, 0.5)); }
      50% { filter: drop-shadow(0 0 25px rgba(255, 182, 193, 1)); }
    }
    
    .radiance-flash {
      animation: radianceFlash 0.8s ease-out;
    }
    
    .float-mantra {
      animation: floatUp 3s ease-out forwards;
    }

    .lotus-button {
      animation: lotusGlow 2s ease-in-out infinite;
    }
    
    .lotus-button.active {
      animation: lotusGlow 0.5s ease-in-out infinite;
    }

    /* 佛珠样式 */
    .bead {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      position: absolute;
      background: linear-gradient(135deg, #8B4513 0%, #A0522D 50%, #8B4513 100%);
      box-shadow: inset -2px -2px 4px rgba(0,0,0,0.3), inset 2px 2px 4px rgba(255,255,255,0.1);
      transition: all 0.3s ease;
    }
    
    .bead.active {
      background: linear-gradient(135deg, #FFD700 0%, #FFA500 50%, #FFD700 100%);
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
      transform: scale(1.3);
    }
    
    .bead.passed {
      background: linear-gradient(135deg, #DAA520 0%, #B8860B 50%, #DAA520 100%);
      box-shadow: 0 0 8px rgba(218, 165, 32, 0.4);
    }

    .tassel {
      position: absolute;
      top: -30px;
      left: 50%;
      transform: translateX(-50%);
      width: 3px;
      height: 40px;
      background: linear-gradient(to bottom, #8B4513, #DAA520);
    }
    
    .tassel::after {
      content: '';
      position: absolute;
      bottom: -15px;
      left: 50%;
      transform: translateX(-50%);
      width: 20px;
      height: 20px;
      background: radial-gradient(circle, #DAA520 0%, #8B4513 100%);
      clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
    }

    @media (max-width: 1024px) {
      .layout-container {
        flex-direction: column !important;
        padding: 1rem !important;
      }
      .beads-section, .deity-section, .stats-section {
        width: 100% !important;
        margin-bottom: 2rem;
      }
      .deity-section img {
        width: 300px !important;
      }
    }
  </style>
</head>
<body>
  <div class="relative w-full h-screen overflow-hidden bg-gradient-to-b from-[#0a1628] via-[#1a2742] to-[#0f1b33]">
    <!-- 音效 -->
    <audio id="audio" preload="auto">
      <source src="./莲生_1.wav" type="audio/wav">
    </audio>

    <!-- 星光背景 -->
    <div id="stars" class="absolute inset-0"></div>
    
    <!-- 放射光晕容器 -->
    <div id="radiance-container" class="absolute inset-0 pointer-events-none"></div>
    
    <!-- 飘散咒语容器 -->
    <div id="mantra-container" class="absolute inset-0 pointer-events-none"></div>

    <!-- 三栏布局 -->
    <div class="layout-container absolute inset-0 flex items-center justify-between px-8">
      
      <!-- 左侧：佛珠 -->
      <div class="beads-section w-1/4 flex items-center justify-center">
        <div class="relative w-80 h-80">
          <div class="tassel"></div>
          <div id="beads-container" class="relative w-full h-full"></div>
          <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-center">
            <div id="bead-progress" class="text-amber-300 text-3xl font-bold">0/108</div>
            <div id="cycle-status" class="text-amber-200 text-sm mt-2"></div>
          </div>
        </div>
      </div>

      <!-- 中间：咒语 + 法相 -->
      <div class="deity-section w-2/4 flex flex-col items-center justify-center gap-8">
        <!-- 咒语在上方 -->
        <div class="text-center">
          <div class="text-amber-100 text-3xl leading-loose tracking-wider">
            嗡。咕噜。莲生。悉地。吽。
          </div>
        </div>
        
        <!-- 法相 -->
        <div class="relative">
          <!-- 背景大光明 -->
          <div id="background-radiance" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[600px] h-[600px] rounded-full pointer-events-none opacity-0 transition-opacity duration-300"
               style="background: radial-gradient(circle, rgba(255,215,0,0.4) 0%, rgba(255,215,0,0.2) 40%, transparent 70%);">
          </div>
          
          <div id="deity" class="relative transition-all duration-300" style="opacity: 0.2;">
            <img src="./師尊-2.png" alt="莲花童子法相" class="w-[450px] h-auto select-none" draggable="false">
          </div>
        </div>
      </div>

      <!-- 右侧：今日精进 -->
      <div class="stats-section w-1/4 flex flex-col items-center justify-center gap-8">
        <div class="text-center">
          <p class="text-amber-100 text-lg tracking-widest mb-4">今日精进</p>
          <p id="today-count" class="text-white text-6xl mb-2">0</p>
          <p class="text-amber-200 text-2xl">/ 100,000 遍</p>
        </div>

        <div class="w-64">
          <div class="w-full h-3 bg-white/10 rounded-full overflow-hidden backdrop-blur-sm">
            <div id="progress-bar" class="h-full bg-gradient-to-r from-amber-400 to-amber-200 transition-all duration-500" style="width: 0%"></div>
          </div>
          <p id="progress-text" class="text-amber-200/60 text-sm text-center mt-3">还需 100,000 遍</p>
        </div>

        <div class="text-center mt-4">
          <p class="text-amber-100/60 text-sm mb-2">累积持诵</p>
          <p id="total-count" class="text-amber-100 text-3xl">0</p>
        </div>
      </div>
    </div>

    <!-- 底部莲花按钮 -->
    <div class="absolute bottom-12 left-1/2 -translate-x-1/2 z-20">
      <button id="lotus-button" class="lotus-button relative w-48 h-48 cursor-pointer select-none transition-transform duration-150 hover:scale-105 active:scale-95">
        <img src="./7ffe8482-386a-4733-9ad9-f08b64f12be5.jpeg" alt="莲花" class="w-full h-full object-contain">
        <div id="lotus-text" class="absolute bottom-4 left-1/2 -translate-x-1/2 text-amber-100 text-lg font-bold whitespace-nowrap">
          开始持咒
        </div>
      </button>
    </div>
  </div>

  <script>
    const DAILY_GOAL = 100000;
    const TOTAL_BEADS = 108;
    const MANTRA_TEXT = "嗡。咕噜。莲生。悉地。吽。";
    
    let totalCount = 0;
    let todayCount = 0;
    let currentBead = 0;
    let beadElements = [];
    
    let isChanting = false;
    let currentCycle = 0; // 当前周期内的计数 (0-107)
    let chantingInterval = null;
    
    const audio = document.getElementById('audio');
    const deity = document.getElementById('deity');
    const backgroundRadiance = document.getElementById('background-radiance');
    const lotusButton = document.getElementById('lotus-button');
    const lotusText = document.getElementById('lotus-text');
    const cycleStatus = document.getElementById('cycle-status');
    
    // 初始化星光
    const starsContainer = document.getElementById('stars');
    for (let i = 0; i < 50; i++) {
      const star = document.createElement('div');
      star.className = 'star';
      star.style.left = Math.random() * 100 + '%';
      star.style.top = Math.random() * 100 + '%';
      star.style.animationDelay = Math.random() * 2 + 's';
      star.style.animationDuration = (Math.random() * 3 + 2) + 's';
      starsContainer.appendChild(star);
    }
    
    // 初始化佛珠
    const beadsContainer = document.getElementById('beads-container');
    for (let i = 0; i < TOTAL_BEADS; i++) {
      const angle = (i * 360) / TOTAL_BEADS - 90;
      const radian = (angle * Math.PI) / 180;
      const radius = 150;
      const x = Math.cos(radian) * radius;
      const y = Math.sin(radian) * radius;
      
      const bead = document.createElement('div');
      bead.className = 'bead';
      bead.style.left = '50%';
      bead.style.top = '50%';
      bead.style.transform = `translate(${x}px, ${y}px) translate(-50%, -50%)`;
      
      beadsContainer.appendChild(bead);
      beadElements.push(bead);
    }
    
    // 更新佛珠状态
    function updateBeads() {
      beadElements.forEach((bead, i) => {
        const isActive = i === currentCycle;
        const isPassed = i < currentCycle;
        
        bead.classList.remove('active', 'passed');
        
        if (isActive && isChanting) {
          bead.classList.add('active');
        } else if (isPassed) {
          bead.classList.add('passed');
        }
      });
    }
    
    // 闪光效果
    function flashRadiance() {
      const radiance = document.createElement('div');
      radiance.className = 'radiance-flash absolute top-1/2 left-1/2 w-[800px] h-[800px] rounded-full pointer-events-none';
      radiance.style.background = 'radial-gradient(circle, rgba(255,215,0,0.7) 0%, rgba(255,215,0,0.4) 30%, transparent 70%)';
      document.getElementById('radiance-container').appendChild(radiance);
      
      setTimeout(() => radiance.remove(), 800);
      
      // 飘散咒语
      const mantra = document.createElement('div');
      mantra.className = 'float-mantra absolute text-amber-300 text-xl pointer-events-none font-bold';
      mantra.textContent = MANTRA_TEXT;
      mantra.style.left = (Math.random() * 30 + 35) + '%';
      mantra.style.top = (Math.random() * 30 + 35) + '%';
      document.getElementById('mantra-container').appendChild(mantra);
      
      setTimeout(() => mantra.remove(), 3000);
    }
    
    // 念诵一遍
    function chantOnce() {
      if (!isChanting) return;
      
      // 播放音频
      audio.currentTime = 0;
      audio.play().catch(err => console.log('音效播放失败:', err));
      
      // 更新计数
      totalCount++;
      todayCount++;
      currentCycle++;
      currentBead = todayCount % TOTAL_BEADS;
      
      saveData(totalCount, todayCount);
      updateDisplay();
      updateBeads();
      flashRadiance();
      
      // 如果完成108遍，停止
      if (currentCycle >= TOTAL_BEADS) {
        stopChanting();
        currentCycle = 0;
        updateBeads();
      }
    }
    
    // 开始持咒
    function startChanting() {
      if (isChanting) return;
      
      isChanting = true;
      lotusButton.classList.add('active');
      lotusText.textContent = '持咒中...';
      deity.style.opacity = '1';
      backgroundRadiance.style.opacity = '1';
      
      cycleStatus.textContent = '持咒进行中';
      
      // 立即念第一遍
      chantOnce();
      
      // 监听音频结束事件，自动念下一遍
      audio.onended = function() {
        if (isChanting && currentCycle < TOTAL_BEADS) {
          chantOnce();
        }
      };
    }
    
    // 停止持咒
    function stopChanting() {
      isChanting = false;
      lotusButton.classList.remove('active');
      lotusText.textContent = currentCycle > 0 ? '继续持咒' : '开始持咒';
      
      audio.pause();
      audio.onended = null;
      
      if (currentCycle === 0) {
        deity.style.opacity = '0.2';
        backgroundRadiance.style.opacity = '0';
        cycleStatus.textContent = '';
      } else {
        cycleStatus.textContent = `已暂停 (${currentCycle}/108)`;
      }
    }
    
    // 莲花按钮点击事件
    lotusButton.addEventListener('click', function() {
      if (isChanting) {
        stopChanting();
      } else {
        startChanting();
      }
    });
    
    // 加载数据
    function loadData() {
      try {
        const stored = localStorage.getItem('mantraData');
        if (stored) {
          const data = JSON.parse(stored);
          const today = new Date().toDateString();
          
          if (data.date === today) {
            todayCount = data.todayCount;
          } else {
            todayCount = 0;
            saveData(data.totalCount, 0);
          }
          totalCount = data.totalCount;
          currentBead = todayCount % TOTAL_BEADS;
        }
      } catch (e) {
        console.log('加载数据失败:', e);
      }
      updateDisplay();
      updateBeads();
    }
    
    // 保存数据
    function saveData(newTotal, newToday) {
      try {
        const today = new Date().toDateString();
        localStorage.setItem('mantraData', JSON.stringify({
          totalCount: newTotal,
          todayCount: newToday,
          date: today
        }));
      } catch (e) {
        console.log('保存数据失败:', e);
      }
    }
    
    // 更新显示
    function updateDisplay() {
      document.getElementById('total-count').textContent = totalCount.toLocaleString();
      document.getElementById('today-count').textContent = todayCount.toLocaleString();
      document.getElementById('bead-progress').textContent = `${currentBead}/108`;
      
      const progressPercentage = Math.min((todayCount / DAILY_GOAL) * 100, 100);
      document.getElementById('progress-bar').style.width = progressPercentage + '%';
      
      if (todayCount >= DAILY_GOAL) {
        document.getElementById('progress-text').textContent = '✨ 今日目标已达成 ✨';
      } else {
        document.getElementById('progress-text').textContent = `还需 ${(DAILY_GOAL - todayCount).toLocaleString()} 遍`;
      }
    }
    
    // 初始化
    loadData();
  </script>
</body>
</html>
